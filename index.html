<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>ajax学习</title>
	</head>
	<script>
		//声明一个对象，当做命名空间来使用
		var eg = {};
		//定义一个公共函数来获取指定的id元素，减少代码量，提高代码的复用率
		eg.$ = function(id){
			return document.getElementById(id);
		}		
	</script>
	<body>
		<div id="myajax">hello word!</div>
		<button type="button" id="ajaxBtn">通过AJAX改变内容</button>
		
		
		
	<script>
		//第一个公用的AJAX请求函数
		eg.AJAX = function(config,callback){//接受一个回调函数和一个配置参数
			var xmlhttp;                    //定义一个变量用于后面存储对象
			if(window.XMLHttpRequest){//如果浏览器支持XMLHttpRequest对象，通常非IE浏览器支持
			xmlhttp = new XMLHttpRequest();
			}else if(window.ActiveXObject){
				//如果浏览器支持ActiveXObject对象，通常是IE
				try{//尝试创建一个低版本对象，msxml组件2.6版本以下支持
					xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
				}
				catch (e){
					
					try{//尝试创建一个高版本对象，，msxml组件3.0版本以上支持
						xmlhttp = new ActiveXObject("msxml2.XMLHTTP");
					}
					catch(x){
						
					}
				}
			}
			if(xmlhttp){//如果能够创建成功
				if(config.ISASYN){
					xmlhttp.onreadystatechange = function(){
						//定义HTTP状态发生改变时执行的函数
						if(xmlhttp.readyState ==4&& xmlhttp.status==200)
						{//当请求成功时
							callback(xmlhttp.responseText,xmlhttp.responseXML);
							//把服务器响应的数据回调函数callback
							
						}	
					};
					//将传递的参数给open方法调用
					xmlhttp.open(config.TYPE,config.URL,false);
					xmlhttp.send(config.DATA);//发送异步请求
				
			}else{
				//将传递的参数给open方法调用
				xmlhttp.open(config.TYPE,config.URL,false);
				xmlhttp.send(config.DATA);//发送异步请求
				callback(xmlhttp.responseText,xmlhttp.responseXML);
			}
		}
		
		};
		(function(){//避免全局污染，将操作放在闭包里
			var ajaxBtn = eg.$("ajaxBtn");
			
			//取得uesrname的DOM对象，
			//给userName对象绑定一个onkeyup事件
			eg.addListener(ajaxBtn,"click",function(){
			
			eg.AJAX{TYPE:"GET",//ajax请求类型
			URL:"ajax.txt",
			ISASYN:true  //是否异步
				
			},function (data) {//定义AJAX请求成功后的callback回调函数
				//在元素myajax原本的hello word!变成ajax.txt中的内容
				eg.$("myajax").innerHTML=data;
				
			});
			
			});
		})();
		
	</script>
		
		
		
	</body>
	
	
	
	
</html>
